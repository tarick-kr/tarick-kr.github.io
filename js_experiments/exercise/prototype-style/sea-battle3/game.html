<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">

	<title>Sea Battle v_3</title>
	<meta name="description" content="">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<!-- Template Basic Images Start -->
	<meta property="og:image" content="path/to/image.jpg">
<!-- 	<link rel="icon" href="img/favicon/favicon.ico">
	<link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon-180x180.png"> -->
	<!-- Template Basic Images End -->
	
	<!-- Custom Browsers Color Start -->
	<meta name="theme-color" content="#000">
	<!-- Custom Browsers Color End -->

	<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="libs/bootstrap-4.0.0-dist/css/bootstrap-grid.css">

	<!-- Custom CSS -->
<!-- 	<link rel="stylesheet" href="css/main.css"> -->
	<style>
		body { 
			margin: 0;
		} 
		:-webkit-full-screen #myCanvas {
			width: 100%;
			height: 100%;
		}
	</style>

</head>

<body>
	<!-- Custom HTML -->
	<canvas id="myCanvas" width="640" height="360"></canvas>

<script	type="text/javascript">

var canvas = document.getElementById('myCanvas'),
    context = canvas.getContext('2d'),

// Constants............................................................

	// Constants are listed in alphabetical order from here on out

	BACKGROUND_VELOCITY = 150,

	STARTING_BACKGROUND_VELOCITY = 0,

	STARTING_BACKGROUND_OFFSET = 0,


// Images............................................................

	background  = new Image(),
	sky = new Image();

// Time..............................................................

	lastAnimationFrameTime = 0,
	lastFpsUpdateTime = 0,
	fps = 60,

// Translation offsets...............................................

	backgroundOffset = STARTING_BACKGROUND_OFFSET,


// Velocities........................................................

	bgVelocity = STARTING_BACKGROUND_VELOCITY;


// ---------------------------- FUNCTIONS ------------------------------ 

// Drawing..............................................................

function draw() {
	setOffsets(); //+++
	drawBackground(); //+++
}

function setOffsets() {
	setBackgroundOffset(); //+++
}

function setBackgroundOffset() {
	var offset = backgroundOffset + bgVelocity/fps;

	if (offset > 0 && offset < background.width) {
		backgroundOffset = offset;
	}
	else {
		backgroundOffset = 0;
	}
}

function drawBackground() {
	context.translate(-backgroundOffset, 0);

	// Initially onscreen:
	context.drawImage(background, 0, 0);

	// Initially offscreen:
	context.drawImage(background, background.width, 0);

	context.translate(backgroundOffset, 0);
}

function calculateFps(now) {
	
	var fps = 1000 / (now - lastAnimationFrameTime);
	// console.log(now);
	lastAnimationFrameTime = now;


	if (now - lastFpsUpdateTime > 1000) {
		lastFpsUpdateTime = now;
		// fpsElement.innerHTML = fps.toFixed(0) + ' fps';
	}
	return fps; 
}

function turnRight() {
   bgVelocity = BACKGROUND_VELOCITY;
}
   
// Animation............................................................

function animate(now) { 
   fps = calculateFps(now); //+++
   draw(); //+++
   requestAnimationFrame(animate); //+++
}

// ------------------------- INITIALIZATION ----------------------------

function initializeImages() {
   background.src = 'asset/backgroundSea.png';

   background.onload = function (e) {
      startGame(); //+++
   };
}

function startGame() {
   window.requestAnimationFrame(animate); //+++
}

// Launch game.........................................................

initializeImages(); //+++

setTimeout( function (e) {
   turnRight(); //+++
}, 100);

</script>
</body>
</html>