<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">

	<title>Sea Battle</title>
	<meta name="description" content="">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<!-- Template Basic Images Start -->
	<meta property="og:image" content="path/to/image.jpg">
<!-- 	<link rel="icon" href="img/favicon/favicon.ico">
	<link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon-180x180.png"> -->
	<!-- Template Basic Images End -->
	
	<!-- Custom Browsers Color Start -->
	<meta name="theme-color" content="#000">
	<!-- Custom Browsers Color End -->

	<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="libs/bootstrap-4.0.0-dist/css/bootstrap-grid.css">

	<!-- Custom CSS -->
<!-- 	<link rel="stylesheet" href="css/main.css"> -->
</head>

<body>
	<!-- Custom HTML -->
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-auto">
				<canvas>
					
				</canvas>
 			</div>
		</div>
	</div>



	<script type="text/javascript" src="pointjs_0.2.0.0_demo.js"></script>

	<script	type="text/javascript">

		var pjs = new PointJS('2d', 800, 600);
		pjs.system.initFullPage();

		var game = pjs.game;
		var key = pjs.keyControl;
		var vector = pjs.vector;		
		var point = vector.point;


		var log = pjs.system.log;

		var size = vector.size;
		var camera = pjs.camera;
		var brush = pjs.brush;
		var OOP = pjs.OOP;
		var rand = pjs.math.random;
 
		var height = game.getWH().h;
		var width = game.getWH().w;


		key.initControl();

		var sea1 = game.newImageObject({
			x : 0, y : 0,
			file : 'asset/bgSea2.png',
			h : height,
			onload : function(){
				sea2.x = sea1.x+sea1.w
			}
		})		
		var sea2 = game.newImageObject({
			x : sea1.x+sea1.w, y : 0,
			file : 'asset/bgSea2.png',
			h : height
		})		
		var sky1 = game.newImageObject({
			x : 0, y : 0,
			file : 'asset/bgSky2.png',
			h : height,
			onload : function(){
				sky2.x = sky1.x+sky1.w
			}			
		})		
		var sky2 = game.newImageObject({
			x : sky1.x+sky1.w, y : 0,
			file : 'asset/bgSky2.png',
			h : height			
		})		
		var mySubmarine = game.newAnimationObject({
			x : 50, y : 300,
			h : 45, w : 78,
			delay : -5,
			animation : pjs.tiles.newAnimation('asset/submarine.png', 78, 45, 9)			
		})

		var moveBackGround = function(s){
			sea1.move(point(-s, 0));
			sea2.move(point(-s, 0));

			sky1.move(point(-s/2, 0));
			sky2.move(point(-s/2, 0));

			if (sea1.x + sea1.w < 0){
				sea1.x = sea2.x + sea2.w;
			}
			if (sea2.x + sea2.w < 0){
				sea2.x = sea1.x + sea1.w;
			}			
			if (sky1.x + sky1.w < 0){
				sky1.x = sky2.x + sky2.w;
			}
			if (sky2.x + sky2.w < 0){
				sky2.x = sky1.x + sky1.w;
			}			
		};

		var dy = 0; // падение лодки

		var enemys = [];

		var DX = 0; //сдвиг противников по оси Х 
		var DY = 0; //сдвиг противников по оси Y


		var generateEnemys = function(){
			for (var i = 0; i < 5; i++) {
				DX += rand(300, 700);
				DY = rand(90, height-80);

				enemys.push(
					game.newAnimationObject({
						x : DX + width, 
						y : DY,
						h : 45, w : 78,
						delay : -5,
						animation : pjs.tiles.newAnimation('asset/enemys.png', 78, 45, 9)
					}));
			};
		};	// var generateEnemys = function()

		// var torpedo = null;

		var shoot = function(){
			torpedo = game.newImageObject({
			x : 150, 
			y : 200,
			file : 'asset/torpedo.png'
			})
		};



		// Игровой цикл 'menu' ======================================

		game.newLoop('menu', function(){
			sea1.draw();
			sea2.draw();

			sky1.draw();
			sky2.draw();

			mySubmarine.draw();

			mySubmarine.x = 50;
			mySubmarine.y = 300;

			pjs.brush.drawText({
				text : "Для старта нажмите ENTER",
				font : "roboto", 
				x : 20, y : 20, 
				color : "black",
				size : 25
			});
			pjs.brush.drawText({
				text : "Управление: клавишами A D W S или стрелками",
				font : "roboto", 
				x : 20, y : 60, 
				color : "black",
				size : 25
			});

			if (key.isDown('ENTER')){
				enemys = [];
				DX = 0;
				DY = 0;
				generateEnemys();
				game.setLoop('game');
			}



		});	// Закончился игровой цикл 'menu'	



		

		// Игровой цикл 'game' ======================================


		game.newLoop('game', function(){

			if (key.isDown('ESC')){
				game.setLoop('menu');
			}
			if (key.isPress('SPACE')){
				shoot();
				torpedo.draw();
				console.log('hjgjhjhgj'); 
			}
			if (key.isDown('LEFT') || key.isDown('A')){
				mySubmarine.move(point(-2, 0));
			}			
			if (key.isDown('UP') || key.isDown('W')){
				mySubmarine.move(point(0, -2));
				dy = 0;
			}			
			if (key.isDown('DOWN') || key.isDown('S')){
				mySubmarine.move(point(0, 2));
			}
			if (key.isDown('RIGHT') || key.isDown('D')){
				mySubmarine.move(point(2, 0));
			}

			sea1.draw();
			sea2.draw();
			sky1.draw();
			sky2.draw();
			moveBackGround(2);

			mySubmarine.draw();


			for (var i in enemys){
				var dY = rand(90, height-80);
				enemys[i].x -= 2.2;

				if (enemys[i].x + enemys[i].w < 0) {
					enemys[i].x = 2500;
					enemys[i].y = dY;
				}
				if (mySubmarine.isIntersect(enemys[i])){
					game.setLoop('menu');
				} 
			
				enemys[i].draw();
			}

			if (mySubmarine.y <= 86){
				pjs.brush.drawText({
				text : "Лодки не летают",
				font : "roboto", 
				x : 20, y : 40, 
				color : "black",
				size : 25
				});
				mySubmarine.y = 86;				
			}
			if (mySubmarine.y >= height-80){
				pjs.brush.drawText({
				text : "Там уже дно",
				font : "roboto", 
				x : 20, y : 40, 
				color : "black",
				size : 25
				});
				mySubmarine.y = height-80;				
			}
			if (mySubmarine.x < 0){
				pjs.brush.drawText({
				text : "Туда нельзя",
				font : "roboto", 
				x : 20, y : 40, 
				color : "black",
				size : 25
				});
				mySubmarine.x = 0;				
			}
			if (mySubmarine.x >= width - mySubmarine.w){
				pjs.brush.drawText({
				text : "Туда нельзя",
				font : "roboto", 
				x : 20, y : 40, 
				color : "black",
				size : 25
				});
				mySubmarine.x = width - mySubmarine.w;				
			}	



		});		// Закончился игровой цикл 'game'



		






		game.setLoop('menu');
		game.start();
		



	</script>
</body>
</html>