<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">

	<title>Sea Battle</title>
	<meta name="description" content="">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<!-- Template Basic Images Start -->
	<meta property="og:image" content="path/to/image.jpg">
<!-- 	<link rel="icon" href="img/favicon/favicon.ico">
	<link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon-180x180.png"> -->
	<!-- Template Basic Images End -->
	
	<!-- Custom Browsers Color Start -->
	<meta name="theme-color" content="#000">
	<!-- Custom Browsers Color End -->

	<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="libs/bootstrap-4.0.0-dist/css/bootstrap-grid.css">

	<!-- Custom CSS -->
<!-- 	<link rel="stylesheet" href="css/main.css"> -->
</head>

<body>
	<!-- Custom HTML -->
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-auto">
				<canvas>
					
				</canvas>
 			</div>
		</div>
	</div>



	<script type="text/javascript" src="pointjs_0.2.0.0_demo.js"></script>

	<script	type="text/javascript">

		var pjs = new PointJS('2d', 800, 600);
		pjs.system.initFullPage();

		var game = pjs.game;
		var key = pjs.keyControl;
		var vector = pjs.vector;		
		var point = vector.point;


		var log = pjs.system.log;

		var size = vector.size;
		var camera = pjs.camera;
		var brush = pjs.brush;
		var OOP = pjs.OOP;
		var rand = pjs.math.random;
 
		var height = game.getWH().h;
		var width = game.getWH().w;


		key.initControl();

		var sea1 = game.newImageObject({
			x : 0, y : 0,
			file : 'asset/bgSea2.png',
			h : height,
			onload : function(){
				sea2.x = sea1.x+sea1.w
			}
		})		
		var sea2 = game.newImageObject({
			x : sea1.x+sea1.w, y : 0,
			file : 'asset/bgSea2.png',
			h : height
		})		
		var sky1 = game.newImageObject({
			x : 0, y : 0,
			file : 'asset/bgSky2.png',
			h : height,
			onload : function(){
				sky2.x = sky1.x+sky1.w
			}			
		})		

		var sky2 = game.newImageObject({
			x : sky1.x+sky1.w, y : 0,
			file : 'asset/bgSky2.png',
			h : height			
		})		
		var mySubmarine = game.newAnimationObject({
			x : 0, y : 250,
			h : 60, w : 80,
			delay : -5,
			animation : pjs.tiles.newAnimation('asset/submarine.png', 80, 60, 9)			
		})

		var moveBackGround = function(s){
			sea1.move(point(-s, 0));
			sea2.move(point(-s, 0));

			sky1.move(point(-s/2, 0));
			sky2.move(point(-s/2, 0));

			if (sea1.x + sea1.w < 0){
				sea1.x = sea2.x + sea2.w;
			}
			if (sea2.x + sea2.w < 0){
				sea2.x = sea1.x + sea1.w;
			}			
			if (sky1.x + sky1.w < 0){
				sky1.x = sky2.x + sky2.w;
			}
			if (sky2.x + sky2.w < 0){
				sky2.x = sky1.x + sky1.w;
			}			
		};

		var dy = 0; // падение лодки
		// var dx = 0; // перемещение противников

		var enemys = [];

		var DX = 0; //сдвиг противников по оси Х 
		var DY = 0; //сдвиг противников по оси Y

		for (var i = 0; i < 5; i++) {
			DX += rand(300, 700);
			DY = rand(90, height-80);

			enemys.push(
				game.newAnimationObject({
					x : DX + width, 
					y : DY,
					h : 60, w : 80,
					delay : -5,
					animation : pjs.tiles.newAnimation('asset/enemys.png', 80, 60, 9)
				})

			);
		};



		// Игровой цикл ======================================

		game.newLoop('game', function(){
			// game.fill('#D9D9D9');

			// pjs.presets.bgСycle(sea, -3, 0, 0, 0);

			if (key.isDown('RIGHT') || key.isDown('D')){
				mySubmarine.move(point(2, 0));
			}
			if (key.isDown('LEFT') || key.isDown('A')){
				mySubmarine.move(point(-2, 0));
			}			
			if (key.isDown('UP') || key.isDown('W')){
				mySubmarine.move(point(0, -2));
				dy = 0;
			}			
			if (key.isDown('DOWN') || key.isDown('S')){
				mySubmarine.move(point(0, 2));
			}

			// dy += 0.001;
			// mySubmarine.y += dy;

			// dx -= 0.005;
			// for (var i in enemys){
			// 	enemys[i].x += dx;
			// }

			sea1.draw();
			sea2.draw();

			sky1.draw();
			sky2.draw();


			mySubmarine.draw();

			for (var i in enemys){
				var dY = rand(90, height-80);
				enemys[i].x -= 2.2;
				// console.log(enemys[i].x);
				if (enemys[i].x + enemys[i].w < 0) {
					enemys[i].x = 2500;
					enemys[i].y = dY;
				}
				enemys[i].draw();
			}

			moveBackGround(2);

		});

		// game.startLoop('game');
		game.setLoop('game');
		game.start();
		



	</script>
</body>
</html>